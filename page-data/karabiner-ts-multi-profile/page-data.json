{"componentChunkName":"component---src-templates-blog-post-js","path":"/karabiner-ts-multi-profile/","result":{"data":{"site":{"siteMetadata":{"title":"scraggo.com"}},"markdownRemark":{"id":"8fbcd2c3-10b5-5381-a90a-d8fab01f10ee","excerpt":"I’ve been on a quest to make typing more ergonomic and functional. I want to minimize chording (simultaneous keypresses) and mouse use to reduce pain in my…","html":"<p>I’ve been on a quest to make typing more ergonomic and functional. I want to minimize chording (simultaneous keypresses) and mouse use to reduce pain in my hands, put keys I use more often in more advantageous places, automate repetitive activities, etc.</p>\n<p>So, I was excited to discover <a href=\"https://karabiner-elements.pqrs.org/\">Karabiner-Elements</a> - free Mac software that allows you to do key remapping, control the mouse with the keyboard, run terminal commands, and much more.</p>\n<p>The aims of this post are 1) to share my research, joys, and struggles using <a href=\"https://karabiner-elements.pqrs.org/\">Karabiner-Elements</a> and 2) to share <a href=\"https://github.com/scraggo/karabiner-ts-multi-profile\">my karabiner config which has multi-profile support</a> and utilizes <a href=\"https://github.com/evan-liu/karabiner.ts\">karabiner.ts</a>.</p>\n<h2>Installation, Configuring, and Debugging in Karabiner-Elements</h2>\n<ul>\n<li>Carefully follow <a href=\"https://karabiner-elements.pqrs.org/docs/getting-started/installation/\">the installation instructions</a> to make sure permissions are enabled (otherwise the app won’t work at all!)</li>\n<li>Open <code class=\"language-text\">Karabiner-Elements.app</code></li>\n<li><code class=\"language-text\">UI</code> tab: I opted to put both the <a href=\"https://karabiner-elements.pqrs.org/docs/manual/configuration/configure-menu-bar-icon/\">icon and profile name in the menu bar</a></li>\n<li><code class=\"language-text\">Devices</code> tab: Manipulate caps lock LED on for whichever devices I want to modify</li>\n<li>To do anything <em>slightly</em> complicated, you’ll need to edit the <code class=\"language-text\">~/.config/karabiner/karabiner.json</code> file</li>\n<li><code class=\"language-text\">Log</code> tab: Very useful for debugging - you can see the output of your shell commands (discussed later)</li>\n</ul>\n<p>Also for debugging, <code class=\"language-text\">Karabiner-EventViewer.app</code> shows exactly what keyboard and mouse events are being registered in real time. See <a href=\"https://karabiner-elements.pqrs.org/docs/manual/operation/eventviewer/\">Confirm the result of configuration (EventViewer)</a>.</p>\n<h2>Profiles</h2>\n<ul>\n<li>To start, I opted to make a new profile and leave <code class=\"language-text\">Default</code> alone.</li>\n<li>You can configure a Complex Modification to select a profile with keypresses (more about this in later sections)</li>\n</ul>\n<h2>Simple Modifications</h2>\n<p>You have the choice to modify all devices (choose “For all devices”) or a single device. I only messed with single devices - external keyboards - mainly because I wanted to leave my laptop keyboard unmodified so I could re-type my password in case I accidentally left a profile on and locked the screen.</p>\n<h3>to-from mapping and modifiers</h3>\n<ul>\n<li>You can do basic “to” and “from” key mapping with just the UI.</li>\n<li>You can map “to” and “from” keys with modifiers (shift, control, etc) if you edit the <code class=\"language-text\">~/.config/karabiner/karabiner.json</code> file. (I don’t think the docs mention this.) For example, here’s a mapping of <code class=\"language-text\">\"o\"</code> to <code class=\"language-text\">\"command + option + right_arrow\"</code> (change to right tab):</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"simple_modifications\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"o\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"right_arrow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"modifiers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"left_command\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"left_option\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...etc</span></code></pre></div>\n<p>Within the Karabiner UI, you’ll see the resulting JSON in the “To key” column:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0016e665aa949e31d8e8e5941b7681ef/3f01f/karabiner-simple.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACFklEQVQoz62STW+bQBCGubg/orZzzan9V5ESJ4rvPfjX9dBLsG9tbCf+AMPCfmBgw7Is7GQWO1GV3KoiPcwIsQ/zavBmP2bDKNxDXkr4ta7g51LBYvsCjHGgIgdCM4hTASn2/CiBZQX2JRBeQFnkkOc5SCnhcDjAbDYbevfT+3EQBDkhxApOm0xwQ9PERFFkooSbkHCzjxJDRWGyokJeTHqszCbODefMUMoaxpgNwzC/u7sbe5PJZBTHsayqCuq6tsaYE21rbWvsMzOWidxqVeHzxjaN7oFO2w3v7DZMrBAcCEnk9fX1yLu9nYxxGokS0FpblDoxKKTRNfwhGqI066M1poVaN6CQ1mhYpS2stgebJgRiQuTNzc0Yhbe9sGmaXoi4ilINptHwiMI4DoEnAdQyAyUFVKUA8yLgKS7gaRtYmqY44QfhebJPwiVREO+XkJE1SBFAyfZIAJXYwXofw/NmYymln4VuU4g9yU6xnfB3pOCwewQerUDyAAq6gwKlTrjcxbBaP9kEI78L8TZCYXmO3KKoe0PrukuOdZdntFMlR0RXYcXIXS15l/BjRxlrC/x9cLFlv5TpdDpGu1ZKwUcqRNeqj++WpNRpWW89fvCUBBfqHM7lXV1dfV0sFquHh4cUa+T7fjyfz9/xfYffMz/j/1WRCN9zZ1fO5Q0Ggy/D4fDy4uLiO9Zvo9HoX3BnL53L+9/XK5Yzx6uval97AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JSON for Karabiner simple modification\"\n        title=\"JSON for Karabiner simple modification\"\n        src=\"/static/0016e665aa949e31d8e8e5941b7681ef/799d3/karabiner-simple.png\"\n        srcset=\"/static/0016e665aa949e31d8e8e5941b7681ef/00d96/karabiner-simple.png 148w,\n/static/0016e665aa949e31d8e8e5941b7681ef/0b23c/karabiner-simple.png 295w,\n/static/0016e665aa949e31d8e8e5941b7681ef/799d3/karabiner-simple.png 590w,\n/static/0016e665aa949e31d8e8e5941b7681ef/3f01f/karabiner-simple.png 600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>An example that’s frequently shown as a complex example works in simple modifications - mapping Caps Lock to the “Hyper” key (shift + control + command + option):</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"caps_lock\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"modifiers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"optional\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"any\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"left_shift\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"modifiers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"left_command\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"left_control\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"left_option\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"lazy\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A few notes:</p>\n<ul>\n<li><code class=\"language-text\">from.modifiers</code> is an object and <code class=\"language-text\">to.modifiers</code> is an array. That discrepancy initially confused me. The docs on those fields describes them: <a href=\"https://karabiner-elements.pqrs.org/docs/json/complex-modifications-manipulator-definition/from/modifiers/\">from.modifiers docs</a> and <a href=\"https://karabiner-elements.pqrs.org/docs/json/complex-modifications-manipulator-definition/to/modifiers/\">to.modifiers docs</a></li>\n<li>The <a href=\"https://karabiner-elements.pqrs.org/docs/json/complex-modifications-manipulator-definition/to/lazy/\">to.lazy</a> is helpful when you’re using sticky keys which doesn’t work right if “lazy” is <code class=\"language-text\">false</code>.</li>\n</ul>\n<p>Once a “Hyper” key is set, you can create shortcuts that don’t conflict with most common shortcuts.</p>\n<h3>Sticky keys</h3>\n<p>I get pain in my hands when I do too much chording - simultaneous keypresses like “command + tab” and “command + option + left”. <a href=\"https://karabiner-elements.pqrs.org/docs/help/how-to/sticky-modifier-key/\">Karabiner (versions >= 13.3.0) provides “sticky” keys</a> to address this. When you press the key once, a little display shows up and sticks around until you press the same key or another key. The result is you don’t have to hold two keys down at the same time! Illustrative example:</p>\n<ul>\n<li>In Simple Modifications, set <code class=\"language-text\">left_shift</code> to be <code class=\"language-text\">sticky left_shift</code></li>\n<li>Press left shift, let go, and you’ll see a little notification that shift was pressed</li>\n<li>press ‘a’ and you’ll get ‘A’</li>\n<li>The little notification goes away</li>\n</ul>\n<p><img src=\"https://karabiner-elements.pqrs.org/docs/help/how-to/sticky-modifier-key/images/sticky-modifier-key-indicator@2x.png\" alt=\"Karabiner sticky keys\"></p>\n<p>This was exciting to me - BUT - I then discovered that <strong>sticky keys are built into Macs.</strong> I enabled them on the OS level (through System Settings > Accessibility > Sticky Keys) and I’ve been using them that way ever since.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 398px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eb2c00f1ac9067a1223d57038275bcbe/40fa0/sticky-keys.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.86934673366834%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC/UlEQVQ4y51SSU8TQBjtX2Ap0JY2hS5QIIEuLAKaGJdQPQBGo70JAU24GaiQxiCJlhqNiVhWtQtdaK2pFtEIpLQGaENECFzERA8qh54Aw4VoKc+ZqTRIvOgkL99838y8efO94ezt7YEOGnd3d/8ZiUQidZ6CQ5P94v+Og6Sc/WRzcxPRaDSFSCSSigdxcA/FxsZGiowOpjAWi0Gr1YLH40EkEkEoFKaQm5sLgUDAQOf7NYqcnBzU1dVhfX09pZQRer1eZGdnQyaTIT8/H3l5eZBIJCzSmlwuR2FhIavRC2mkOUVWVhZcLhcjpD1lhE6nk6mrqKzCbaMRjY0NaGltRWenHvLfhFRR7dFjGBjoR011FcmFUCgUrG6z2f4kpDdkpKejvqERg0ODGPN4YLVZ0df3ABq1ih2qrqlFr6kXOp0OJpMJVZUV7AV/JXQ4HKxHBQWFuNnTgwhp9sxMEM1NlyEiPSsuLsGLwDj0HdfA4XBguNENv/8ZiooU4PP5sNvthxS63UhPS8O58xdgsVhgsVoxPDKMEQKNWgmJVArtmbMwm81QE8Xm/gFo606zJwsY4SGFo6OjRCEfZUolOvR6nDp5Ahcv6XD1SiukhIyaIJXKcL2zCwaDAR3t7ZBJJcQwOXOdiqAjHo8nCX0+HzIzMyEWi8EjX4Fuoi2gRtE+7TtPc/pEGmmNXsTlclMu7+zsJAm3trbQ1tbGFKo15eRZ6hSUpKYsU7Ko1migIjWVOhlLS0vR1NyCL9/W8TO+m1QYDs5ggZgw8XICLmKO3+2Ex+lgX8nldMHtGYP3uQ9u0meqxEvWfR4nycmcrC3MBbG2uoDV5XdYXHwPTolYAnEWD4IMLoYeP4FjfhGB8Cwis7MIhUOYDrzG+IAHwalphEIhBCbn4H2zgOlgGJNTQdy1z6P7URQOfxjh4BQ4x5XlUMmLUUMcG5oIQTSXwPjXbfzY/o7I4hLu6OywaR9ixNiHlQ8fYXy6giP3Yni7/AmWV58h6QLUt4D6+9uYX1rDL8THHyu8S4BmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Mac sticky keys\"\n        title=\"Mac sticky keys\"\n        src=\"/static/eb2c00f1ac9067a1223d57038275bcbe/40fa0/sticky-keys.png\"\n        srcset=\"/static/eb2c00f1ac9067a1223d57038275bcbe/00d96/sticky-keys.png 148w,\n/static/eb2c00f1ac9067a1223d57038275bcbe/0b23c/sticky-keys.png 295w,\n/static/eb2c00f1ac9067a1223d57038275bcbe/40fa0/sticky-keys.png 398w\"\n        sizes=\"(max-width: 398px) 100vw, 398px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Pros of Mac Sticky keys:</p>\n<ul>\n<li>You get a few customization options in the system settings panel.</li>\n<li>\n<p>You can press the modifier twice and it will stay on until you disable it which gives you a caps-lock-like functionality. I really like this. Because you can hit ‘shift’ twice,</p>\n<ul>\n<li>caps lock is no longer needed, so you can set it to “hyper”, <code class=\"language-text\">escape</code>, <code class=\"language-text\">delete_forward</code>, or anything you choose!</li>\n<li>My idea to create a “shift” layer became redundant. I was going to make a profile dedicated to the Shifted version of the non-letter keys, like <code class=\"language-text\">&lt;</code> <code class=\"language-text\">></code> <code class=\"language-text\">!</code> <code class=\"language-text\">@</code> etc. Now I didn’t have to.</li>\n</ul>\n</li>\n<li>Older versions of Karabiner (if you use an old OS) don’t have sticky keys.</li>\n</ul>\n<p>Pros of Karabiner Sticky keys:</p>\n<ul>\n<li>You can set which keys you want to be sticky. Setting it at the OS level is all-or-nothing (which works fine for me).</li>\n<li>I didn’t try this, but the behavior might be more consistent in use with modifiers set in Karabiner.</li>\n</ul>\n<p>Cons of Sticky keys:</p>\n<ul>\n<li>You lose the ability to remap double-tapping or long-presses of modifiers</li>\n</ul>\n<h3>Mouse Keys</h3>\n<p>A very interesting option to me is allowing the keyboard to act as a mouse. This functionality is built into the Mac with a feature called “Mouse Keys.” See <a href=\"https://mcmw.abilitynet.org.uk/how-to-control-the-mouse-pointer-using-the-keyboard-in-macos-12-monterey\">Mouse Keys in macOS 12 Monterey | My Computer My Way</a> and <a href=\"https://www.igeeksblog.com/how-to-use-keyboard-as-mouse-on-mac/\">Mouse Keys | igeeksblog</a> and <a href=\"https://osxdaily.com/2021/08/11/how-use-keyboard-as-mouse-mac/\">Mouse Keys | osxdaily</a></p>\n<p>However, I find Mac’s Mouse Keys to be lacking. The highest speed setting is too slow. There doesn’t seem to be a way to speed it up without using another app. See <a href=\"https://apple.stackexchange.com/questions/54677/how-can-i-speed-up-mouse-keys\">How can I speed up Mouse Keys? - Ask Different</a></p>\n<p>Karabiner fills in the gaps. Not only can you fully emulate Mouse Keys at any speed you like, there are a few nice extras - like being able to hold a modifier and speed up or slow down the configured movements.</p>\n<p>There were some confusing configuration bits:</p>\n<ul>\n<li>Moving in the <code class=\"language-text\">y</code> (up/down) direction is backwards to me - a <em>negative</em> number goes up and a <em>positive</em> number goes down. See below for setting “i” to go <em>up</em> 600 pixels:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"i\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"mouse_key\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"y\"</span><span class=\"token operator\">:</span> <span class=\"token number\">-600</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>To move diagonally - up-left, up-right, down-left, and down-right - putting both <code class=\"language-text\">x</code> AND <code class=\"language-text\">y</code> distances in the field (which I didn’t find documented) makes it happen:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"u\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"mouse_key\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"x\"</span><span class=\"token operator\">:</span> <span class=\"token number\">-600</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"y\"</span><span class=\"token operator\">:</span> <span class=\"token number\">-600</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Use <code class=\"language-text\">vertical_wheel</code> and <code class=\"language-text\">horizontal_wheel</code> for scrolling. Both are backwards this time - <em>positive</em> for left/down, <em>negative</em> for right/up:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"y\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"mouse_key\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"vertical_wheel\"</span><span class=\"token operator\">:</span> <span class=\"token number\">32</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>My mouse key mapping:</p>\n<table>\n<thead>\n<tr>\n<th>From</th>\n<th>To</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>u</td>\n<td>↖</td>\n</tr>\n<tr>\n<td>i</td>\n<td>↑</td>\n</tr>\n<tr>\n<td>o</td>\n<td>↗</td>\n</tr>\n<tr>\n<td>j</td>\n<td>←</td>\n</tr>\n<tr>\n<td>l</td>\n<td>→</td>\n</tr>\n<tr>\n<td>m</td>\n<td>↙</td>\n</tr>\n<tr>\n<td>,</td>\n<td>↓</td>\n</tr>\n<tr>\n<td>.</td>\n<td>↘</td>\n</tr>\n<tr>\n<td>k</td>\n<td>left-click</td>\n</tr>\n<tr>\n<td>ctrl+k</td>\n<td>right-click</td>\n</tr>\n<tr>\n<td>;</td>\n<td>scroll ↓</td>\n</tr>\n<tr>\n<td>p</td>\n<td>scroll ↑</td>\n</tr>\n<tr>\n<td>y</td>\n<td>scroll ←</td>\n</tr>\n<tr>\n<td>h</td>\n<td>scroll →</td>\n</tr>\n<tr>\n<td>shift</td>\n<td>speed 3.5</td>\n</tr>\n<tr>\n<td>option</td>\n<td>speed .5</td>\n</tr>\n</tbody>\n</table>\n<p>Note: A few Mac System preferences I messed with:</p>\n<ul>\n<li>Setting the “Primary mouse button” to button 2 <em>does affect</em> Karabiner settings</li>\n<li>Setting “Scroll direction: Natural” <em>doesn’t seem to affect</em> Karabiner settings</li>\n</ul>\n<h2>Function Keys</h2>\n<p>For Function Keys modifications to work how I wanted them to, I set up my Mac System Settings to the following:</p>\n<p><code class=\"language-text\">Keyboard > Use F1, F2, etc as standard function keys</code></p>\n<p>From there, I set my preferred shortcuts, since not all these are provided by Karabiner:</p>\n<ul>\n<li>Mission Control: F3</li>\n<li>Application Windows: F4</li>\n<li>Show Desktop: F5</li>\n</ul>\n<p>In Karabiner, I leave <code class=\"language-text\">Use F1, F2, etc as standard function keys</code> unchecked. Now, anything unassigned in Mac System Settings can be configured by Karabiner.</p>\n<p>In Function keys section, F1, F2, F6-F9 are mapped to themselves. Here’s F1, for example:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f1\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Mission control can be set in Karabiner:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f3\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mission_control\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I really like F10 as mute, F11 as volume down, and F12 as volume up. Here’s the Karabiner config in Function keys section:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f10\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"consumer_key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mute\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f11\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"consumer_key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"volume_decrement\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f12\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"consumer_key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"volume_increment\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Complex Modifications</h2>\n<p>Now for the most powerful part - Complex Modifications. There are <a href=\"https://karabiner-elements.pqrs.org/docs/json/typical-complex-modifications-examples/\">examples in the docs</a> and <a href=\"https://ke-complex-modifications.pqrs.org/\">a ton more examples here.</a>.</p>\n<p>You can save rules you create in JSON files with whatever name you like in <code class=\"language-text\">~/.config/karabiner/assets/complex_modifications/</code>. They’re then accessible when you choose “Add Rule.” See <a href=\"https://karabiner-elements.pqrs.org/docs/json/location/\">File locations | Karabiner-Elements</a></p>\n<p>The area I was most excited to explore was <a href=\"https://karabiner-elements.pqrs.org/docs/json/complex-modifications-manipulator-definition/to/shell-command/\">running shell commands</a>. I used <a href=\"https://karabiner-elements.pqrs.org/docs/manual/misc/command-line-interface/\">Karabiner’s Command line interface</a> to switch between Karabiner profiles. I made a profile called “Nav” that enabled me to correspond a key to running the command to switch to that layer:</p>\n<ul>\n<li>Use a key dedicated to switching to “Nav”. I chose F1.</li>\n<li>Once in “Nav”, you can hit a key to choose another profile. F1 -> my main profile, F2 -> mouse, etc.</li>\n<li>Set all the non-layer profiles with F1 -> “Nav” layer.</li>\n</ul>\n<p>Here’s the JSON to select the “Nav” profile:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f1 -> select profile: Nav\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"manipulators\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"key_code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f1\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"to\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"shell_command\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"'/Library/Application Support/org.pqrs/Karabiner-Elements/bin/karabiner_cli' --select-profile 'Nav'\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"basic\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In the earlier section on debugging, I mentioned the <code class=\"language-text\">Log</code> tab. That was really useful for determining why a bash script I wrote (not provided here) wasn’t running correctly. Turns out, Karabiner was using an older version of bash than was on my machine. I found a workaround by setting it to run with zsh, but there are other options you can explore that I won’t go into here.</p>\n<h2>My Config and External Karabiner JSON generators</h2>\n<p>Manually editing the JSON config isn’t the greatest user-experience. Thankfully, there are <a href=\"https://karabiner-elements.pqrs.org/docs/json/external-json-generators/\">external Karabiner JSON generators</a> that help with this problem.</p>\n<ul>\n<li>The first one I looked into was <a href=\"https://github.com/yqrashawn/GokuRakuJoudo\">Goku</a> and it didn’t work for me. I got weird Java exceptions no matter how simple the code I put in. <a href=\"https://github.com/yqrashawn/GokuRakuJoudo/issues/44\">It only allows complex modifications</a>. <a href=\"https://github.com/yqrashawn/GokuRakuJoudo/blob/master/examples.org#profiles\">Profiles aren’t well supported</a> and I wanted multiple-profiles instead of “layers” and “sim-layers”.</li>\n<li>\n<p>I wound up <a href=\"https://github.com/scraggo/karabiner-ts-multi-profile\">generating my config</a> with <a href=\"https://github.com/evan-liu/karabiner.ts\">karabiner.ts</a>. Given the nice developer experience and it’s high-level of parity with Karabiner features, I recommend it highly! To fit my use cases, I added utilities to</p>\n<ul>\n<li>create simple and function key modifications</li>\n<li>add modifications to multiple profiles and optionally devices within</li>\n</ul>\n</li>\n</ul>\n<h2>Karabiner limitations and other things to look out for</h2>\n<p>The <a href=\"https://karabiner-elements.pqrs.org/docs/getting-started/features/\">features page</a> notes some limitations of Karabiner.</p>\n<p>Operator priority: <a href=\"https://karabiner-elements.pqrs.org/docs/json/complex-modifications-manipulator-evaluation-priority/\">complex_modifications manipulator evaluation priority | Karabiner-Elements</a></p>\n<blockquote>\n<p>Simple Modifications and Complex Modifications are independent.</p>\n</blockquote>\n<p>Weird Behavior</p>\n<ul>\n<li>I found that after switching to certain profiles, keymaps wouldn’t register right away. The most frustrating one was my mouse profile - pressing ‘j’ to move left, for example, would insert a ‘j’ character for at least a few keypresses.</li>\n<li>Sticky keys incompatibilities - noted earlier, it took me a while to figure out why my “hyper” key mods weren’t working. Adding <code class=\"language-text\">\"lazy\": true</code> makes the key-mapping not-sticky, which is sort of a bummer.</li>\n</ul>\n<p>Performance</p>\n<ul>\n<li>Switching profiles is sometimes slow - taking up to ~2 seconds.</li>\n</ul>\n<h2>Conclusion</h2>\n<p>Thanks for reading and a big thank you to the creators of <a href=\"https://karabiner-elements.pqrs.org/\">Karabiner-Elements</a> and <a href=\"https://github.com/evan-liu/karabiner.ts\">karabiner.ts</a>. I’m curious to hear if you try the utilities in <a href=\"https://github.com/scraggo/karabiner-ts-multi-profile\">my karabiner config repo</a>.</p>","fields":{"slug":"/karabiner-ts-multi-profile/"},"frontmatter":{"author":"Dave Cohen","categories":["tech"],"date":"July 30, 2023","description":null,"tags":["TypeScript","ergonomics"],"title":"Notes on Karabiner-elements and karabiner-ts-multi-profile"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/karabiner-ts-multi-profile/","previous":{"fields":{"slug":"/building-my-second-brain/"},"frontmatter":{"tags":["productivity","tech talk"],"title":"How I'm Building My Second Brain","type":"post"}},"next":{"fields":{"slug":"/multimodal-learning-unleashing-human-memory/"},"frontmatter":{"tags":["creativity","productivity","tech talk"],"title":"Multimodal Learning - Unleashing the human memory","type":"post"}}}}}